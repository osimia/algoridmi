Техническая и Функциональная Спецификация Платформы "Ал Хоразми"
1. Введение
Данный документ описывает структуру и функциональные требования для образовательной платформы "Ал Хоразми", предназначенной для обучения и соревнований в области математики.
Технический Стек:
Бэкенд: Python (Django 4.x / Django REST Framework)
База Данных: PostgreSQL
Аутентификация: Стандартный Django Auth (или Custom User Model)
Фронтенд: HTML/JS/Tailwind (взаимодействие с бэкендом через REST API)
2. Структура Базы Данных (PostgreSQL Schema)
База данных PostgreSQL будет организована вокруг четырех основных приложений Django: users, problems, arena, и core.


Таблица (Модель Django)
Назначение
Ключевые Поля
User
Пользователи платформы (Standard Django User)
id, email, password, is_active
Profile (users.Profile)
Расширенная информация о пользователе
user (FK), country, al_khwarizmi_index (Integer), total_solved_problems (Integer), total_arena_points (Integer)
Topic (problems.Topic)
Категории и темы задач
name (e.g., 'Алгебра: Иррациональные уравнения'), difficulty_base (Integer)
Problem (problems.Problem)
Основная база задач
topic (FK), latex_formula (Text), correct_answer (Text), difficulty_score (Integer), solution_steps (JSONField)
UserAttempt (problems.UserAttempt)
Журнал попыток решения задач
user (FK), problem (FK), submitted_answer (Text), is_correct (Boolean), attempt_date (DateTime), points_awarded (Integer)
ArenaRank (arena.ArenaRank)
Рейтинговая таблица для Арены
user (FK), current_index (Integer), current_division (Text), weekly_score (Integer), rank (Integer)

3. Структура Приложения Django
3.1. Приложение users (Управление Пользователями)
Компонент
Детали
Models
Profile (OneToOne с User). Хранит индекс и статистику.
Views/API
/api/user/profile/: GET для получения профиля, PUT для обновления страны или других настроек.

3.2. Приложение problems (Задачи и Решения)
Это ядро платформы, отвечающее за генерацию, выдачу и проверку задач.
Компонент
Детали
Models
Topic, Problem, UserAttempt.
Views/API
/api/problems/generate/ (GET): Выдает новую задачу. Логика: выбирает Problem с difficulty_score в диапазоне [Index - 100, Index + 50].


/api/problems/submit/ (POST): Принимает problem_id и submitted_answer (или solution_photo).
submit Logic
1. Проверка ответа: Сравнивает submitted_answer с Problem.correct_answer. 2. Обновление Индекса: В случае успеха, обновляет Profile.al_khwarizmi_index по ELO-подобному алгоритму, добавляет запись в UserAttempt, увеличивает total_solved_problems. 3. Анализ фото: Для поля solution_photo вызывается внутренний сервис (может быть заглушкой), который возвращает результат анализа.

3.3. Приложение arena (Соревнования и Рейтинг)
Компонент
Детали
Models
ArenaRank.
Views/API
/api/arena/leaderboard/ (GET): Возвращает Топ-10 пользователей текущего дивизиона, отсортированных по weekly_score.
Management Command
./manage.py update_arena_ranks: Cron-задача, запускаемая раз в неделю (или ежедневно) для перерасчета weekly_score и обновления ArenaRank на основе Profile.al_khwarizmi_index и последних UserAttempt.

4. Пользовательский Интерфейс и Функционал (Пошаговая Детализация)
4.1. Страница: Аутентификация (Login/Registration)
Шаг
Действие Пользователя
Бэкенд (Django API)
Детали Функционала
1. Вход
Вводит Email/Пароль, нажимает "Войти".
POST /api/auth/login/ (Django Auth)
При успешном входе возвращает токен (JWT или Session ID). Фронтенд сохраняет токен. Внимание: В тестовой среде, при ошибке auth/operation-not-allowed, фронтенд автоматически переключается в Демонстрационный режим и открывает Дашборд с гостевым ID.
2. Регистрация
Вводит Email, Пароль, выбирает Страну.
POST /api/auth/register/ (Django Auth + создает Profile)
Создает нового User и связанный Profile с указанной страной и начальным Индексом (например, 1000).
3. Выход
Нажимает кнопку "Выход".
POST /api/auth/logout/
Аннулирует токен/сессию, перенаправляет на страницу входа.

4.2. Страница: Дашборд (Главная)
Цель: Предоставить пользователю текущую задачу, отслеживание прогресса и статус Индекса.
Секция
Функционал
Бэкенд (Django API)
Лаборатория Задач
Отображает формулу (в KaTeX) и текст текущей задачи.
Загрузка: GET /api/problems/generate/
Форма Проверки
Ввод ответа: Отправляет числовой ответ. Фото решения: Отправляет изображение решения.
Отправка: POST /api/problems/submit/
Фидбек и Объяснение
После отправки, отображает: 1. ✅ Верно / ❌ Неверно. 2. Детальный разбор решения (из Problem.solution_steps). 3. Начисленные Кванты/Очки.
Ответ от POST /api/problems/submit/ содержит статус, очки, и шаги решения.
Контекстный Учебник
Скрытый микро-урок по теме задачи.
Данные урока берутся из Topic или могут быть статичными/кешированными.
Прогресс (Графон)
Отображение прогресса по основным темам (Topic).
GET /api/user/progress/ (вычисляет процент верных решений по каждой Topic из UserAttempt).
Индекс Ал Хоразми
Текущее значение Индекса.
Данные берутся из Profile.al_khwarizmi_index.

4.3. Страница: Арена (Соревнования)
Цель: Мотивация через соревнование, отображение рейтинга и дивизионов.
Секция
Функционал
Бэкенд (Django API)
Ваш Дивизион
Отображает текущую лигу пользователя (например, "Лига Евклида" по диапазону Индекса).
Берется из Profile.al_khwarizmi_index (фронтенд-логика) и ArenaRank.
Система Дивизионов
Статичное описание дивизионов (Новички, Евклида, Эйнштейна) и требуемого Индекса.
Статичные данные.
Топ-10
Таблица лидеров текущего дивизиона за неделю/месяц.
GET /api/arena/leaderboard/?division=Euclid (запрашивает данные из ArenaRank).

4.4. Страница: Профиль
Цель: Показать личную статистику и информацию.
Секция
Функционал
Бэкенд (Django API)
Основная Информация
Email, Страна, Первая буква имени (инициалы).
GET /api/user/profile/
Статистика
Общее количество решенных задач, звание, общее время в системе.
Данные из Profile.total_solved_problems и дополнительных полей в Profile.

5. Дополнительные Требования и Особенности
5.1. Управление Сложностью (Difficulty Management)
Система должна динамически подбирать задачи.
Начальная Сложность: Все новые пользователи начинают с Индекса 1000 (Лига Евклида).
Генерация: Запрос на новую задачу (/problems/generate/) должен включать параметр user_index. Бэкенд фильтрует задачи по сложности difficulty_score вблизи этого индекса.
Обновление Индекса: Обновление Индекса происходит только после успешного решения. Величина изменения Индекса зависит от разницы между difficulty_score задачи и текущим al_khwarizmi_index пользователя (высокая награда за сложную задачу, малая — за легкую).
5.2. Обработка Изображений Решений
Фронтенд отправляет изображение на POST /api/problems/submit/.
Django сохраняет изображение во временное хранилище (например, S3 или локальная файловая система).
Django вызывает асинхронную задачу (например, через Celery) для отправки файла в AI сервис анализа рукописного ввода.
Сервис AI возвращает результат (например, JSON с шагами, ошибкой, и оценкой).
Django обновляет UserAttempt и возвращает результат пользователю.
5.3. Безопасность
Использование HTTPS для всех коммуникаций.
Применение CSRF-токенов для всех POST/PUT/DELETE запросов Django.
Все API-эндпоинты должны требовать аутентификации (кроме входа/регистрации).
Строгая валидация всех входящих данных.
