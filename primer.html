<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –ê–ª –•–æ—Ä–∞–∑–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX CSS –∏ JS –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" 
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" 
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" 
            crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            padding: 24px;
        }
        .division-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .division-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.2), 0 4px 6px -4px rgba(59, 130, 246, 0.1);
        }
        .tab-content {
            min-height: 400px;
        }
        .nav-link.active {
            color: #3b82f6;
            border-bottom-width: 3px;
            border-color: #3b82f6;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .progress-bar-container {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #22c55e;
        }
        .katex-display {
            margin-top: 0.5em !important;
            margin-bottom: 0.5em !important;
        }
    </style>
</head>
<body class="antialiased">

    <!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –ú–æ–¥–∞–ª—å–Ω–æ–µ –û–∫–Ω–æ -->
    <div id="authModal" class="fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center z-[100] transition-opacity duration-300">
        <div class="card w-full max-w-md mx-4 p-8">
            <h2 id="authTitle" class="text-2xl font-bold text-slate-800 mb-6 text-center">–í—Ö–æ–¥ –≤ –ê–ª –•–æ—Ä–∞–∑–º–∏</h2>
            <div id="authFormContent">
                
                <!-- –§–æ—Ä–º–∞ –í—Ö–æ–¥–∞ (Login) -->
                <form id="loginForm" class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ (–ª—é–±–∞—è –¥–ª—è –¥–µ–º–æ)" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å (–ª—é–±–æ–π –¥–ª—è –¥–µ–º–æ)" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <button type="submit" class="w-full btn-primary">–í–æ–π—Ç–∏</button>
                    <p class="text-sm text-center text-slate-600">
                        –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <button type="button" class="text-blue-600 hover:text-blue-800 font-medium" onclick="toggleAuthView('register')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </p>
                </form>

                <!-- –§–æ—Ä–º–∞ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (Register) -->
                <form id="registerForm" class="space-y-4 hidden">
                    <input type="email" id="registerEmail" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ (–ª—é–±–∞—è –¥–ª—è –¥–µ–º–æ)" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å (–ª—é–±–æ–π, –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    
                    <!-- –î—Ä–æ–ø–¥–∞—É–Ω –¥–ª—è –°—Ç—Ä–∞–Ω—ã -->
                    <select id="countrySelect" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-slate-600">
                        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Å—Ç—Ä–∞–Ω—É</option>
                        <!-- –û–ø—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è JS -->
                    </select>

                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg font-semibold transition-colors">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    <p class="text-sm text-center text-slate-600">
                        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <button type="button" class="text-blue-600 hover:text-blue-800 font-medium" onclick="toggleAuthView('login')">–í–æ–π—Ç–∏</button>
                    </p>
                </form>
            </div>
            <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ -->
            <p id="authMessage" class="mt-4 text-center text-sm font-medium"></p>
        </div>
    </div>


    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è (–°–∫—Ä—ã—Ç–∞ –¥–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏) -->
    <nav id="navbar" class="bg-white sticky top-0 z-50 shadow-md hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center">
                    <span class="text-3xl font-bold text-blue-600">üìê –ê–ª –•–æ—Ä–∞–∑–º–∏</span>
                </div>
                <div class="flex space-x-6">
                    <button class="nav-link font-medium transition duration-150 active" data-tab="tab-dashboard">–î–∞—à–±–æ—Ä–¥</button>
                    <button class="nav-link font-medium transition duration-150" data-tab="tab-arena">–ê—Ä–µ–Ω–∞</button>
                    <button class="nav-link font-medium transition duration-150" data-tab="tab-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userInfo" class="text-sm text-slate-500"></span>
                    <button class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg text-sm font-semibold transition-colors" onclick="handleSignOut()">–í—ã—Ö–æ–¥</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ö–æ–Ω—Ç–µ–Ω—Ç–∞ (–°–∫—Ä—ã—Ç –¥–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏) -->
    <main id="mainContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç 1: –î–∞—à–±–æ—Ä–¥ -->
        <div id="tab-dashboard" class="tab-content">
            <h1 class="text-2xl font-bold text-slate-800 mb-6">–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–π –ü—É—Ç—å (–ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏)</h1>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- –ö–æ–ª–æ–Ω–∫–∞ —Å–ª–µ–≤–∞: –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞ (–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ó–∞–¥–∞—á) -->
                <div class="lg:col-span-2 card">
                    <h2 class="text-xl font-bold text-slate-700 mb-4">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ó–∞–¥–∞—á: –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞</h2>
                    <p class="text-sm text-slate-500 mb-4">–ó–∞–¥–∞—á–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ò–ò —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.</p>
                    
                    <!-- –ò–º–∏—Ç–∞—Ü–∏—è –ó–∞–¥–∞—á–∏ (–¢–µ–ø–µ—Ä—å —Å –∫—Ä—É–ø–Ω—ã–º, –∫–Ω–∏–∂–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º —Ñ–æ—Ä–º—É–ª—ã) -->
                    <div class="bg-blue-50 p-6 rounded-lg mb-6 border-l-4 border-blue-400">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3">–ó–∞–¥–∞—á–∞ ‚Ññ: 4578-–ò–ò</h3>
                        <p class="text-slate-700 mb-4">
                            –î–∞–Ω–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ:
                            <!-- –§–æ—Ä–º—É–ª–∞ –≤ –∫–Ω–∏–∂–Ω–æ–º (Display Math) —Ñ–æ—Ä–º–∞—Ç–µ -->
                            <div class="text-center my-4 text-xl font-mono">
                                $$\sqrt{3x + 1} = x - 1$$
                            </div>
                            –ù–∞–π–¥–∏—Ç–µ —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –∫–æ—Ä–Ω–µ–π —É—Ä–∞–≤–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç —É—Å–ª–æ–≤–∏—é $x > 0$.
                        </p>
                        <p class="text-sm text-slate-500">–¢–µ–º–∞: –ò—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è. –°–ª–æ–∂–Ω–æ—Å—Ç—å: 6/10.</p>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –í–≤–æ–¥–∞ –û—Ç–≤–µ—Ç–∞ –∏ –ü–æ–º–æ—â—å -->
                    <div class="flex flex-col gap-4">
                        <div class="flex flex-col sm:flex-row gap-4 items-center">
                            <input type="text" id="answerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç..." class="flex-grow p-3 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <input type="file" id="photoSolutionInput" accept="image/*" class="hidden" onchange="displayFileName()">
                            <div class="flex gap-4 flex-shrink-0">
                                <button class="bg-indigo-500 hover:bg-indigo-600 text-white p-3 rounded-lg font-semibold transition-colors flex items-center justify-center text-sm" onclick="document.getElementById('photoSolutionInput').click()">
                                    üì∑ –§–æ—Ç–æ –†–µ—à–µ–Ω–∏—è
                                </button>
                                <button class="btn-primary" onclick="checkSolution()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                            </div>
                            <button id="helpBtn" class="bg-amber-500 hover:bg-amber-600 text-white p-3 rounded-lg font-semibold transition-colors flex-shrink-0 text-sm" onclick="toggleHelp()">
                                üí° –ü–æ–º–æ—â—å
                            </button>
                        </div>
                        <p id="fileNameDisplay" class="text-sm text-slate-500 hidden">
                            –§–∞–π–ª –≤—ã–±—Ä–∞–Ω: <span class="font-medium text-slate-700"></span>
                        </p>
                    </div>

                    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –£—á–µ–±–Ω–∏–∫ (–°–∫—Ä—ã—Ç—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="helpContent" class="hidden mt-6 bg-yellow-50 p-6 rounded-lg border-l-4 border-yellow-400">
                        <h3 class="text-lg font-bold text-amber-800 mb-3">–ú–∏–∫—Ä–æ-–£—Ä–æ–∫ –æ—Ç –ê–≥–µ–Ω—Ç–∞ –ê–ª –•–æ—Ä–∞–∑–º–∏: –ö–∞–∫ —Ä–µ—à–∞—Ç—å –∏—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è?</h3>
                        <p class="text-slate-700 mb-4">
                            –í–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫—É –≤ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–∏ –æ–±–µ–∏—Ö —á–∞—Å—Ç–µ–π –≤ –∫–≤–∞–¥—Ä–∞—Ç. –ü–æ–º–Ω–∏—Ç–µ:
                        </p>
                        <ul class="list-disc list-inside text-slate-600 ml-4 space-y-2">
                            <li>**–ü—Ä–∞–≤–∏–ª–æ 1 (–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–Ω—è):** –í–æ–∑–≤–æ–¥–∏—Ç–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç **–æ–±–µ —á–∞—Å—Ç–∏** —É—Ä–∞–≤–Ω–µ–Ω–∏—è, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç—É, —á—Ç–æ —Å –∫–æ—Ä–Ω–µ–º.</li>
                            <li>**–ü—Ä–∞–≤–∏–ª–æ 2 (–û–±–ª–∞—Å—Ç—å –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π):** –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ —É—Å–ª–æ–≤–∏—è, —á—Ç–æ–±—ã –∫–æ—Ä–µ–Ω—å –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω ($3x+1 \ge 0$) –∏ –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å –±—ã–ª–∞ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞ ($x-1 \ge 0$).</li>
                        </ul>
                        <div class="mt-4">
                            <span class="text-sm text-slate-500">–ò–∑—É—á–∏—Ç–µ —ç—Ç–æ, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–¥–∞—á–µ.</span>
                        </div>
                    </div>

                    <!-- –§–∏–¥–±–µ–∫ (–°–∫—Ä—ã—Ç—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <p id="feedback" class="mt-4 font-semibold hidden"></p>

                    <!-- –î–µ—Ç–∞–ª—å–Ω–æ–µ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –†–µ—à–µ–Ω–∏—è (–ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏) -->
                    <div id="solutionExplanation" class="hidden mt-6 card p-6 border-l-4" style="background-color: #f0fdf4; border-color: #4ade80;">
                        <h3 class="text-xl font-bold text-green-800 mb-4" id="explanationTitle"></h3>
                        <div id="explanationContent" class="text-slate-700 space-y-3">
                        </div>
                        <p class="mt-4 text-sm font-semibold text-green-700" id="pointsEarned"></p>
                    </div>
                </div>

                <!-- –ö–æ–ª–æ–Ω–∫–∞ —Å–ø—Ä–∞–≤–∞: –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –ò–Ω–¥–µ–∫—Å -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ü—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                    <div class="card">
                        <h3 class="text-xl font-bold text-slate-700 mb-4">–í–∞—à –ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>–ê–ª–≥–µ–±—Ä–∞: –ò—Ä—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è</span>
                                    <span>70%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" style="width: 70%; background-color: #3b82f6;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>–¢–µ–æ—Ä–∏—è –ß–∏—Å–µ–ª: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—é</span>
                                    <span>45%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" style="width: 45%; background-color: #f97316;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm text-slate-600 mb-1">
                                    <span>–ì–µ–æ–º–µ—Ç—Ä–∏—è: –í–ø–∏—Å–∞–Ω–Ω—ã–µ —É–≥–ª—ã</span>
                                    <span>92%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar" style="width: 92%; background-color: #22c55e;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ò–Ω–¥–µ–∫—Å–∞ –ê–ª –•–æ—Ä–∞–∑–º–∏ -->
                    <div class="card bg-blue-50">
                        <h3 class="text-xl font-bold text-blue-700 mb-2">–ò–Ω–¥–µ–∫—Å –ê–ª –•–æ—Ä–∞–∑–º–∏</h3>
                        <p class="text-4xl font-extrabold text-blue-600 mb-3">1520</p>
                        <p class="text-sm text-slate-600">
                            –í–∞—à –∏–Ω–¥–µ–∫—Å –æ—Ç—Ä–∞–∂–∞–µ—Ç –≤–∞—à —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –∑–∞–¥–∞—á –∏ –≤–∞—à –¥–∏–≤–∏–∑–∏–æ–Ω –Ω–∞ –ê—Ä–µ–Ω–µ.
                        </p>
                        <div class="mt-3 flex justify-between text-xs text-slate-500">
                            <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è "–ú–∞–≥–∏—Å—Ç—Ä–∞": 1800</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç 2: –ê—Ä–µ–Ω–∞ -->
        <div id="tab-arena" class="tab-content hidden">
            <h1 class="text-2xl font-bold text-slate-800 mb-6">–ê—Ä–µ–Ω–∞ –ê–ª –•–æ—Ä–∞–∑–º–∏: –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –∏ –†–µ–π—Ç–∏–Ω–≥</h1>
            <div class="card mb-8">
                <h2 class="text-xl font-bold text-slate-700 mb-3">–í–∞—à –î–∏–≤–∏–∑–∏–æ–Ω: –õ–∏–≥–∞ –ï–≤–∫–ª–∏–¥–∞</h2>
                <p class="text-sm text-slate-500 mb-4">–í—ã —Å–æ—Ä–µ–≤–Ω—É–µ—Ç–µ—Å—å —Å –∏–≥—Ä–æ–∫–∞–º–∏ —Å –ò–Ω–¥–µ–∫—Å–æ–º –æ—Ç 501 –¥–æ 1550.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-yellow-50 rounded-lg text-center border border-yellow-300">
                        <p class="text-xl font-bold text-yellow-700">#47</p>
                        <p class="text-sm text-slate-600">–í–∞—à–µ –º–µ—Å—Ç–æ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg text-center border border-slate-300">
                        <p class="text-xl font-bold text-slate-700">üèÜ 3</p>
                        <p class="text-sm text-slate-600">–í—Å–µ–≥–æ –ö—É–±–∫–æ–≤ –î–∏–≤–∏–∑–∏–æ–Ω–∞</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg text-center border border-slate-300">
                        <p class="text-xl font-bold text-slate-700">ü•á 8</p>
                        <p class="text-sm text-slate-600">–í—Å–µ–≥–æ –ó–æ–ª–æ—Ç—ã—Ö –ú–µ–¥–∞–ª–µ–π</p>
                    </div>
                </div>
            </div>

            <h2 class="text-xl font-bold text-slate-700 mb-4">–°–∏—Å—Ç–µ–º–∞ –î–∏–≤–∏–∑–∏–æ–Ω–æ–≤</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="division-card card p-6 bg-slate-100 text-center">
                    <p class="text-2xl mb-2">‚≠ê</p>
                    <h3 class="font-bold text-slate-800">–õ–∏–≥–∞ –ù–æ–≤–∏—á–∫–æ–≤</h3>
                    <p class="text-sm text-slate-500">–ò–Ω–¥–µ–∫—Å: 100 - 500</p>
                </div>
                <div class="division-card card p-6 bg-blue-100 text-center border-blue-400 border-2">
                    <p class="text-2xl mb-2">üèÜ</p>
                    <h3 class="font-bold text-blue-800">–õ–∏–≥–∞ –ï–≤–∫–ª–∏–¥–∞ (–í—ã –ó–¥–µ—Å—å)</h3>
                    <p class="text-sm text-slate-500">–ò–Ω–¥–µ–∫—Å: 501 - 1550</p>
                </div>
                <div class="division-card card p-6 bg-slate-100 text-center">
                    <p class="text-2xl mb-2">üß†</p>
                    <h3 class="font-bold text-slate-800">–õ–∏–≥–∞ –≠–π–Ω—à—Ç–µ–π–Ω–∞</h3>
                    <p class="text-sm text-slate-500">–ò–Ω–¥–µ–∫—Å: 1551+</p>
                </div>
            </div>
            
            <h2 class="text-xl font-bold text-slate-700 mt-10 mb-4">–¢–æ–ø-10 –õ–∏–≥–∏ –ï–≤–∫–ª–∏–¥–∞ (–ù–µ–¥–µ–ª—è 42)</h2>
            <div class="card overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200">
                    <thead class="bg-slate-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">–ú–µ—Å—Ç–æ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">–ò–º—è</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">–ò–Ω–¥–µ–∫—Å</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">–û—á–∫–∏</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-slate-200 text-sm">
                        <tr><td class="px-6 py-4 whitespace-nowrap font-bold">1</td><td class="px-6 py-4 whitespace-nowrap">–ò–≤–∞–Ω –î.</td><td class="px-6 py-4 whitespace-nowrap">1545</td><td class="px-6 py-4 whitespace-nowrap">4500</td></tr>
                        <tr><td class="px-6 py-4 whitespace-nowrap font-bold">2</td><td class="px-6 py-4 whitespace-nowrap">–ú–∞—Ä–∏—è –ö.</td><td class="px-6 py-4 whitespace-nowrap">1538</td><td class="px-6 py-4 whitespace-nowrap">4480</td></tr>
                        <tr><td class="px-6 py-4 whitespace-nowrap font-bold">3</td><td class="px-6 py-4 whitespace-nowrap">User 10294</td><td class="px-6 py-4 whitespace-nowrap">1531</td><td class="px-6 py-4 whitespace-nowrap">4300</td></tr>
                        <tr class="bg-blue-50 font-semibold"><td class="px-6 py-4 whitespace-nowrap">47</td><td class="px-6 py-4 whitespace-nowrap">–ê—Ä—Ç—ë–º (–í—ã)</td><td class="px-6 py-4 whitespace-nowrap">1520</td><td class="px-6 py-4 whitespace-nowrap">2150</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç 3: –ü—Ä–æ—Ñ–∏–ª—å (–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã) -->
        <div id="tab-profile" class="tab-content hidden">
            <h1 class="text-2xl font-bold text-slate-800 mb-6">–ü—Ä–æ—Ñ–∏–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
            <div class="card max-w-xl mx-auto text-center">
                <div class="w-20 h-20 rounded-full bg-blue-500 flex items-center justify-center text-3xl font-bold text-white mx-auto mb-4" id="profileInitial">A</div>
                <h3 class="text-xl font-bold text-slate-800" id="profileEmail"></h3>
                <p class="text-slate-600 mb-4" id="profileCountry"></p>
                <div class="grid grid-cols-3 gap-4 border-t pt-4">
                    <div><p class="text-2xl font-bold text-blue-600">300+</p><p class="text-sm text-slate-500">–†–µ—à–µ–Ω–æ –ó–∞–¥–∞—á</p></div>
                    <div><p class="text-2xl font-bold text-blue-600">–ú–∞–≥–∏—Å—Ç—Ä</p><p class="text-sm text-slate-500">–ó–≤–∞–Ω–∏–µ</p></div>
                    <div><p class="text-2xl font-bold text-blue-600">12—á</p><p class="text-sm text-slate-500">–û–±—â–µ–µ –≤—Ä–µ–º—è</p></div>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        // --- FIREBASE –ò–ú–ü–û–†–¢–´ ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let currentUserId = null;
        let currentUserData = {};

        // --- –°–ü–ò–°–û–ö –°–¢–†–ê–ù –î–õ–Ø –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ---
        const countries = [
            { code: 'RU', name: '–†–æ—Å—Å–∏—è' },
            { code: 'KZ', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω' },
            { code: 'UZ', name: '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω' },
            { code: 'KG', name: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω' },
            { code: 'TJ', name: '–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω' },
            { code: 'UA', name: '–£–∫—Ä–∞–∏–Ω–∞' },
            { code: 'BY', name: '–ë–µ–ª–∞—Ä—É—Å—å' },
            { code: 'AZ', name: '–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω' },
        ];
        
        // --- –£–¢–ò–õ–ò–¢–´ FIREBASE ---
        const getUserProfileRef = (userId) => {
            // –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—É—Ç—å –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            return doc(db, 'artifacts', appId, 'users', userId, 'user_profiles', 'profile_data');
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        const setAuthMessage = (message, isError = false) => {
            const msgElement = document.getElementById('authMessage');
            msgElement.textContent = message;
            msgElement.className = `mt-4 text-center text-sm font-medium ${isError ? 'text-red-500' : 'text-green-500'}`;
        };

        // --- –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø ---

        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing.");
                    setAuthMessage("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase.", true);
                    return;
                }
                
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // 1. –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∏–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // 2. –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        if (user.email) {
                            await fetchUserProfile(user);
                        } else {
                            // –ê–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ (–¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏–ª–∏ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏)
                            currentUserData = { 
                                email: `–ì–æ—Å—Ç—å-${user.uid.substring(0, 4)}@demo.com`, 
                                country: '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º' 
                            };
                        }
                        updateUI(true); // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—à–±–æ—Ä–¥
                    } else {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
                        currentUserId = null;
                        currentUserData = {};
                        updateUI(false); // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error.code, error.message);
                setAuthMessage("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –°–º. –∫–æ–Ω—Å–æ–ª—å.", true);
            }
        }
        
        async function fetchUserProfile(user) {
            try {
                const docRef = getUserProfileRef(user.uid);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    currentUserData = docSnap.data();
                    currentUserData.email = user.email;
                } else {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª –ø–æ –ø–æ—á—Ç–µ, –Ω–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
                    currentUserData = { email: user.email, country: '–ù–µ —É–∫–∞–∑–∞–Ω–∞' };
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
                currentUserData = { email: user.email, country: '–ù–µ —É–∫–∞–∑–∞–Ω–∞ (–æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏)' };
            }
        }

        async function handleSignUp(e) {
            e.preventDefault();
            setAuthMessage('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...');
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const country = document.getElementById('countrySelect').value;

            if (!country) {
                setAuthMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Å—Ç—Ä–∞–Ω—É.", true);
                return;
            }

            try {
                // 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è –≤ Firestore
                const profileData = {
                    country: country,
                    createdAt: new Date().toISOString()
                };
                await setDoc(getUserProfileRef(user.uid), profileData);

                setAuthMessage('–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...', false);
                // onAuthStateChanged —Å–∞–º –æ–±–Ω–æ–≤–∏—Ç UI
            } catch (error) {
                console.error("Registration Error Code:", error.code);
                console.error("Registration Error:", error);
                let message = "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—à–∏–±–∫–∏.";
                
                if (error.code === 'auth/email-already-in-use') {
                    message = "–≠—Ç–æ—Ç –∞–¥—Ä–µ—Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.";
                } else if (error.code === 'auth/weak-password') {
                    message = "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤.";
                } else if (error.code === 'auth/operation-not-allowed') {
                    // –õ–û–ì–ò–ö–ê –î–ï–ú–û: –í—Ö–æ–¥ –ø–æ Email/–ü–∞—Ä–æ–ª—é –æ—Ç–∫–ª—é—á–µ–Ω -> –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥
                    message = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...";
                    setAuthMessage(message, true);
                    await signInAnonymously(auth); 
                    return; // onAuthStateChanged –∑–∞–∫—Ä–æ–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                }
                setAuthMessage(message, true);
            }
        }

        async function handleSignIn(e) {
            e.preventDefault();
            setAuthMessage('–í—Ö–æ–¥...');

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                setAuthMessage('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞...', false);
                // onAuthStateChanged —Å–∞–º –æ–±–Ω–æ–≤–∏—Ç UI
            } catch (error) {
                console.error("Login Error Code:", error.code);
                console.error("Login Error:", error);
                let message = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–∞—Ä–æ–ª—å.";
                
                if (error.code === 'auth/invalid-email' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    message = "–ù–µ–≤–µ—Ä–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∏–ª–∏ –ø–∞—Ä–æ–ª—å.";
                } else if (error.code === 'auth/operation-not-allowed') {
                     // –õ–û–ì–ò–ö–ê –î–ï–ú–û: –í—Ö–æ–¥ –ø–æ Email/–ü–∞—Ä–æ–ª—é –æ—Ç–∫–ª—é—á–µ–Ω -> –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥
                    message = "–í—Ö–æ–¥ –ø–æ Email/–ü–∞—Ä–æ–ª—é –æ—Ç–∫–ª—é—á–µ–Ω. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...";
                    setAuthMessage(message, true);
                    await signInAnonymously(auth); 
                    return; // onAuthStateChanged –∑–∞–∫—Ä–æ–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                }
                setAuthMessage(message, true);
            }
        }

        async function handleSignOut() {
            try {
                await signOut(auth);
                // onAuthStateChanged —Å–∞–º –æ–±–Ω–æ–≤–∏—Ç UI
            } catch (error) {
                console.error("Sign Out Error:", error);
            }
        }
        
        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï UI ---

        function fillCountryDropdown() {
            const select = document.getElementById('countrySelect');
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = country.name;
                select.appendChild(option);
            });
        }

        function toggleAuthView(view) {
            document.getElementById('loginForm').classList.toggle('hidden', view === 'register');
            document.getElementById('registerForm').classList.toggle('hidden', view === 'login');
            document.getElementById('authTitle').textContent = view === 'register' ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : '–í—Ö–æ–¥ –≤ –ê–ª –•–æ—Ä–∞–∑–º–∏';
            setAuthMessage('');
        }

        function updateUI(isAuthenticated) {
            const authModal = document.getElementById('authModal');
            const navbar = document.getElementById('navbar');
            const mainContent = document.getElementById('mainContent');
            const userInfo = document.getElementById('userInfo');
            const profileEmail = document.getElementById('profileEmail');
            const profileCountry = document.getElementById('profileCountry');
            const profileInitial = document.getElementById('profileInitial');


            if (isAuthenticated) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê–ö–¢–ò–í–ï–ù (–ª–∏–±–æ –Ω–∞—Å—Ç–æ—è—â–∏–π, –ª–∏–±–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π)
                authModal.classList.add('hidden');
                navbar.classList.remove('hidden');
                mainContent.classList.remove('hidden');
                
                const user = auth.currentUser;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –∏ —Å—Ç—Ä–∞–Ω—É
                let displayName = currentUserData.email || '–ì–æ—Å—Ç—å (–ê–Ω–æ–Ω–∏–º–Ω–æ)';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –ª–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                const isDemoMode = displayName.startsWith('–ì–æ—Å—Ç—å-') || !user.email;
                
                let userCountryName;
                if (isDemoMode) {
                    userCountryName = '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º';
                    userInfo.textContent = `–†–µ–∂–∏–º –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ | ID: ${user.uid.substring(0, 8)}`;
                } else {
                    userCountryName = (currentUserData.country && user.email) 
                        ? (countries.find(c => c.code === currentUserData.country)?.name || currentUserData.country) 
                        : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    userInfo.textContent = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${displayName.split('@')[0]} | –°—Ç—Ä–∞–Ω–∞: ${userCountryName}`;
                }

                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                profileEmail.textContent = displayName;
                profileCountry.textContent = `–°—Ç—Ä–∞–Ω–∞: ${userCountryName}`;
                profileInitial.textContent = displayName.charAt(0).toUpperCase();

            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª (Logged out)
                authModal.classList.remove('hidden');
                navbar.classList.add('hidden');
                mainContent.classList.add('hidden');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
                setAuthMessage("–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º.", false);
            }
            
            // –ó–∞–ø—É—Å–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ñ–æ—Ä–º—É–ª –ø–æ—Å–ª–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, { 
                    delimiters: [
                        { left: '$$', right: '$$', display: true }, 
                        { left: '$', right: '$', display: false }
                    ] 
                });
            }
        }
        
        // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–ê–®–ë–û–†–î–ê ---

        function toggleHelp() {
            const helpContent = document.getElementById('helpContent');
            const helpBtn = document.getElementById('helpBtn');
            const isHidden = helpContent.classList.toggle('hidden');
            helpBtn.textContent = isHidden ? 'üí° –ü–æ–º–æ—â—å' : '–°–∫—Ä—ã—Ç—å –£—Ä–æ–∫';
        }

        function displayFileName() {
            const input = document.getElementById('photoSolutionInput');
            const display = document.getElementById('fileNameDisplay');
            const fileNameSpan = display.querySelector('span');

            if (input.files.length > 0) {
                fileNameSpan.textContent = input.files[0].name;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        function showDetailedSolution(isCorrect, isPhotoCheck) {
            const expDiv = document.getElementById('solutionExplanation');
            const expTitle = document.getElementById('explanationTitle');
            const expContent = document.getElementById('explanationContent');
            const pointsEarned = document.getElementById('pointsEarned');

            expDiv.classList.remove('hidden');
            
            const detailedSteps = `
                <h4 class="font-semibold text-slate-800">–ü–æ—à–∞–≥–æ–≤–æ–µ –†–µ—à–µ–Ω–∏–µ:</h4>
                <ol class="list-decimal list-inside ml-4 space-y-2">
                    <li>**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–û–î–ó):** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –ø–æ–¥–∫–æ—Ä–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –±—ã–ª–æ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º ($3x + 1 \\ge 0 \\Rightarrow x \\ge -1/3$) –∏ –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å –±—ã–ª–∞ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞ ($x - 1 \\ge 0 \\Rightarrow x \\ge 1$). –û–±—â–µ–µ —É—Å–ª–æ–≤–∏–µ: $x \\ge 1$.</li>
                    <li>**–í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç:** –í–æ–∑–≤–æ–¥–∏–º –æ–±–µ —á–∞—Å—Ç–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –∫–≤–∞–¥—Ä–∞—Ç: $$3x + 1 = (x - 1)^2$$ $$3x + 1 = x^2 - 2x + 1$$</li>
                    <li>**–ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–æ—Å–∏–º –≤—Å–µ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É: $$x^2 - 5x = 0$$ $$x(x - 5) = 0$$</li>
                    <li>**–ö–æ—Ä–Ω–∏:** –ù–∞—Ö–æ–¥–∏–º –¥–≤–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–æ—Ä–Ω—è: $x_1 = 0$ –∏ $x_2 = 5$.</li>
                    <li>**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –û–î–ó:**
                        <ul>
                            <li>$x_1 = 0$: –ù–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—é $x \\ge 1$. –û—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º.</li>
                            <li>$x_2 = 5$: –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—é $x \\ge 1$. –ü—Ä–∏–Ω–∏–º–∞–µ–º.</li>
                        </ul>
                    </li>
                    <li>**–§–∏–Ω–∞–ª—å–Ω—ã–π –û—Ç–≤–µ—Ç:** –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ—Ä–µ–Ω—å, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–π —É—Å–ª–æ–≤–∏—é $x > 0$ (–∏ –û–î–ó), —ç—Ç–æ $x=5$. –ó–∞–¥–∞—á–∞ –ø—Ä–æ—Å–∏—Ç —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –∫–æ—Ä–Ω–µ–π, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏—Ö —É—Å–ª–æ–≤–∏—é $x > 0$. –°—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤: $$5^2 = 25$$</li>
                </ol>
            `;

            if (isCorrect) {
                expTitle.textContent = "‚úÖ –†–µ—à–µ–Ω–∏–µ –í–µ—Ä–Ω–æ! –†–∞–∑–±–æ—Ä –ê–≥–µ–Ω—Ç–∞ –ê–ª –•–æ—Ä–∞–∑–º–∏:";
                expContent.innerHTML = detailedSteps;
                pointsEarned.textContent = isPhotoCheck 
                    ? '–ù–∞—á–∏—Å–ª–µ–Ω–æ 250 –ö–≤–∞–Ω—Ç–æ–≤ –∑–∞ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è!' 
                    : '–ù–∞—á–∏—Å–ª–µ–Ω–æ 150 –ö–≤–∞–Ω—Ç–æ–≤ –∑–∞ –≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç.';
                expDiv.style.backgroundColor = '#f0fdf4'; 
                expDiv.style.borderColor = '#4ade80';
            } else {
                expTitle.textContent = "‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –û—à–∏–±–∫–∞ –≤ –†–µ—à–µ–Ω–∏–∏:";
                expContent.innerHTML = isPhotoCheck 
                    ? `<p class="text-red-700">–ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à–µ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª, —á—Ç–æ –≤—ã –≤–µ—Ä–Ω–æ –Ω–∞—à–ª–∏ –∫–æ—Ä–Ω–∏ $x=0$ –∏ $x=5$, –Ω–æ **–∑–∞–±—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ $x \\ge 1$** (–û–î–ó). –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –≤—ã –≤–∫–ª—é—á–∏–ª–∏ –ª–æ–∂–Ω—ã–π –∫–æ—Ä–µ–Ω—å $x=0$.</p>` + detailedSteps
                    : `<p class="text-red-700">–ö–æ–Ω–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–Ω–æ. –ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –Ω–∏–∂–µ.</p>` + detailedSteps;
                pointsEarned.textContent = '–ö–≤–∞–Ω—Ç—ã –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã.';
                expDiv.style.style.backgroundColor = '#fef2f2'; 
                expDiv.style.borderColor = '#f87171';
            }
            
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(expContent, {
                    delimiters: [
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false }
                    ]
                });
            }
        }

        async function checkSolution() {
            const answerInput = document.getElementById('answerInput');
            const photoInput = document.getElementById('photoSolutionInput');
            const feedback = document.getElementById('feedback');
            const explanation = document.getElementById('solutionExplanation');
            const answer = answerInput.value.trim();
            const CORRECT_ANSWER = '25';

            feedback.classList.remove('hidden');
            feedback.classList.remove('text-green-600', 'text-red-600', 'text-slate-500', 'text-blue-600');
            explanation.classList.add('hidden');

            const isPhotoCheck = photoInput.files.length > 0;
            
            if (isPhotoCheck) {
                feedback.textContent = '‚è≥ –ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–µ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 —Å–µ–∫—É–Ω–¥—ã)...';
                feedback.classList.add('text-blue-600');
                await new Promise(resolve => setTimeout(resolve, 2000));
                const simulatedResult = (answer === CORRECT_ANSWER || answer === '');
                
                if (simulatedResult) {
                    feedback.textContent = `‚úÖ –í–∞—à–µ —Ä—É–∫–æ–ø–∏—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –æ—Ç–≤–µ—Ç –í–ï–†–ù–´!`;
                    feedback.className = 'mt-4 font-semibold text-green-600';
                    showDetailedSolution(true, true);
                } else {
                    feedback.textContent = '‚ùå –ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ. –û—à–∏–±–∫–∞ –¥–æ–ø—É—â–µ–Ω–∞ –Ω–∞ —à–∞–≥–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –û–±–ª–∞—Å—Ç–∏ –î–æ–ø—É—Å—Ç–∏–º—ã—Ö –ó–Ω–∞—á–µ–Ω–∏–π (–û–î–ó). –°–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä.';
                    feedback.className = 'mt-4 font-semibold text-red-600';
                    showDetailedSolution(false, true);
                }
                answerInput.value = '';
                photoInput.value = null; 
                document.getElementById('fileNameDisplay').classList.add('hidden');
            } else if (answer !== '') {
                feedback.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞...';
                feedback.classList.add('text-blue-600');
                await new Promise(resolve => setTimeout(resolve, 500));

                if (answer === CORRECT_ANSWER) {
                    feedback.textContent = '‚úÖ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.';
                    feedback.className = 'mt-4 font-semibold text-green-600';
                    showDetailedSolution(true, false);
                } else {
                    feedback.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ê–≥–µ–Ω—Ç –ê–ª –•–æ—Ä–∞–∑–º–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –Ω–∏–∂–µ.';
                    feedback.className = 'mt-4 font-semibold text-red-600';
                    showDetailedSolution(false, false);
                }
                answerInput.value = '';
            } else {
                feedback.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç –ò–õ–ò –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ä–µ—à–µ–Ω–∏—è!';
                feedback.classList.remove('text-blue-600');
                feedback.classList.add('text-slate-500');
            }
        }
        
        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

        document.addEventListener('DOMContentLoaded', () => {
            const navButtons = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');

            function showTab(tabId) {
                tabContents.forEach(content => { content.classList.add('hidden'); });
                document.getElementById(tabId).classList.remove('hidden');
            }

            function setActiveButton(button) {
                navButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    showTab(tabId);
                    setActiveButton(button);
                });
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            document.getElementById('registerForm').addEventListener('submit', handleSignUp);
            document.getElementById('loginForm').addEventListener('submit', handleSignIn);

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ —Å—Ç—Ä–∞–Ω
            fillCountryDropdown();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            initializeFirebase();

            // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞)
            showTab('tab-dashboard');
            const firstButton = document.querySelector('[data-tab="tab-dashboard"]');
            if (firstButton) setActiveButton(firstButton);
        });
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏, —á—Ç–æ–±—ã –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑ inline-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        window.toggleHelp = toggleHelp;
        window.displayFileName = displayFileName;
        window.checkSolution = checkSolution;
        window.toggleAuthView = toggleAuthView;
        window.handleSignOut = handleSignOut;
    </script>
</body>
</html>