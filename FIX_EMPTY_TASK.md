# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Å—Ç—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

## üòû –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–Ω–æ: —Ç–µ–º–∞ –µ—Å—Ç—å ("–ê–ª–≥–µ–±—Ä–∞: –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"), –∞ —Å–∞–º–∞ –∑–∞–¥–∞—á–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ.

## üîç –ü—Ä–∏—á–∏–Ω—ã
1. **Gemini –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `problem_text`** –ø–æ–ª–µ
2. **–ü—É—Å—Ç–æ–µ –ø–æ–ª–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ API**
3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç fallback –Ω–∞ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è**

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–£—Å–∏–ª–µ–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è Gemini**
```python
üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø –ü–û–ù–ò–ú–ù–û–°–¢–ò –ó–ê–î–ê–ß–ò:
- problem_text: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–ø–æ–ª–Ω–∏—Ç—å! –ß–ï–¢–ö–û –∏ –ü–û–ù–Ø–¢–ù–û –æ–ø–∏—à–∏ —É—Å–ª–æ–≤–∏–µ
- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø–æ–ª—è –ø—É—Å—Ç—ã–º–∏!
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π**
```python
if field == 'problem_text' and not problem_data[field].strip():
    raise ValueError("–ü–æ–ª–µ problem_text –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!")
```

### 3. **–£–ª—É—á—à–µ–Ω fallback –≤ API**
```python
'text': problem_data.get('problem_text') or problem_data.get('description') or problem_data.get('title', '–ó–∞–¥–∞—á–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è...')
```

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
logger.debug(f"üîç –ü–æ–ª—è –æ—Ç Gemini: {list(problem_data.keys())}")
logger.debug(f"üìù problem_text: {problem_data.get('problem_text', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')}")
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Å –æ—Ç–ª–∞–¥–∫–æ–π**
```bash
python manage.py runserver --settings=al_khwarizmi.settings
```

### 2. **–í–∫–ª—é—á–∏—Ç—å DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–í `settings.py` –¥–æ–±–∞–≤–∏—Ç—å:
```python
LOGGING = {
    'version': 1,
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'problems.views_gemini': {
            'handlers': ['console'],
            'level': 'DEBUG',
        },
    },
}
```

### 3. **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É**
```bash
GET /api/problems/generate-ai/
Authorization: Bearer <token>
```

### 4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**
–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üîç –ü–æ–ª—è –æ—Ç Gemini: ['title', 'problem_text', 'description', ...]
üìù problem_text: –ù–∞–π–¥–∏—Ç–µ –∫–æ—Ä–Ω–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è: x¬≤ - 5x + 6 = 0
```

## üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç API:
```json
{
  "problem": {
    "topic_name": "–ê–ª–≥–µ–±—Ä–∞: –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
    "title": "–†–µ—à–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
    "text": "–ù–∞–π–¥–∏—Ç–µ –∫–æ—Ä–Ω–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è: x¬≤ - 5x + 6 = 0",
    "equation": "x^2 - 5x + 6 = 0",
    "difficulty_score": 850,
    "hints": ["–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç", "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä–Ω–∏ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π"],
    "generated_by_ai": true
  }
}
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–±—ã–ª–æ —Ä–∞–Ω—å—à–µ):
```json
{
  "problem": {
    "topic_name": "–ê–ª–≥–µ–±—Ä–∞: –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è", 
    "title": "–†–µ—à–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
    "text": "",  // –ü–£–°–¢–û!
    "equation": "",
    ...
  }
}
```

## üîÑ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

### 1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Gemini**
```
‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç Gemini: ...
‚ùå –ü–æ–ª–µ problem_text –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç Gemini**
–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ª–æ–≥:
```python
logger.info(f"ü§ñ –û—Ç–≤–µ—Ç Gemini: {response_text}")
```

### 3. **Fallback —Ä–µ—à–µ–Ω–∏–µ**
–ï—Å–ª–∏ Gemini –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `problem_text`:
```python
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
if not problem_data.get('problem_text'):
    problem_data['problem_text'] = f"–†–µ—à–∏—Ç–µ –∑–∞–¥–∞—á—É: {problem_data.get('title', '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞')}"
    if problem_data.get('equation_to_solve'):
        problem_data['problem_text'] += f"\n\n–£—Ä–∞–≤–Ω–µ–Ω–∏–µ: {problem_data['equation_to_solve']}"
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ü—Ä–æ–º–ø—Ç**: –£—Å–∏–ª–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ `problem_text`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –ø–æ–ª—è
3. **Fallback**: –†–µ–∑–µ—Ä–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Ç–ª–∞–¥–∫–∞ –ø–æ–ª–µ–π –æ—Ç Gemini
5. **API**: –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìä –°—Ç–∞—Ç—É—Å

- ‚úÖ –ü—Ä–æ–º–ø—Ç —É—Å–∏–ª–µ–Ω
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞  
- ‚úÖ Fallback —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
- üîÑ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å —Ç–µ–∫—Å—Ç! üöÄ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 26 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è**: 2.2.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
