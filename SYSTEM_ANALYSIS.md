# üîç –ê–Ω–∞–ª–∏–∑ –°–∏—Å—Ç–µ–º—ã –∏ –ü—Ä–æ–±–ª–µ–º

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ URL-–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ Endpoints

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`/api/auth/`):**
- `POST /api/auth/register/` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login/` - –í—Ö–æ–¥
- `POST /api/auth/logout/` - –í—ã—Ö–æ–¥
- `GET /api/auth/csrf/` - CSRF —Ç–æ–∫–µ–Ω

**–ü—Ä–æ—Ñ–∏–ª—å (`/api/user/`):**
- `GET /api/user/profile/` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `GET/PUT /api/user/profile-detail/` - –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è
- `GET /api/user/progress/` - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º

**–ó–∞–¥–∞—á–∏ (`/api/problems/`):**
- `GET /api/problems/generate/` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á–∏
- `POST /api/problems/submit/` - –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
- `GET /api/problems/attempts/` - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫
- `GET /api/problems/topics/` - –°–ø–∏—Å–æ–∫ —Ç–µ–º

**–ê—Ä–µ–Ω–∞/–†–µ–π—Ç–∏–Ω–≥ (`/api/arena/`):**
- `GET /api/arena/leaderboard/` - –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ ‚ö†Ô∏è
- `GET /api/arena/stats/` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚ö†Ô∏è

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –î–æ—Å—Ç—É–ø–æ–º –∫ –†–µ–π—Ç–∏–Ω–≥—É –∏ –ü—Ä–æ—Ñ–∏–ª—é –Ω–∞ –ú–æ–±–∏–ª—å–Ω—ã—Ö

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

#### A. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω/–ø–æ—Ä—Ç
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `CORS_ALLOWED_ORIGINS` –≤ settings.py

#### B. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏–∏
- –°–µ—Å—Å–∏–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- Cookie –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
- `SESSION_COOKIE_SECURE` –∏ `SESSION_COOKIE_SAMESITE` –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### C. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Arena
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ `/api/arena/leaderboard/` —Å–æ–∑–¥–∞–µ—Ç—Å—è `ArenaRank`
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è - –æ—à–∏–±–∫–∞

#### D. –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- `select_related` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

#### A. –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î
```python
# ‚ùå –ú–ï–î–õ–ï–ù–ù–û - N+1 –ø—Ä–æ–±–ª–µ–º–∞
for topic in topics:
    attempts = UserAttempt.objects.filter(user=user, problem__topic=topic)
    
# ‚úÖ –ë–´–°–¢–†–û - –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
topics_with_stats = Topic.objects.annotate(
    total_attempts=Count('problem__userattempt', filter=Q(problem__userattempt__user=user))
)
```

#### B. Gemini API –≤—ã–∑–æ–≤—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `gemini-2.0-flash-exp` (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- –õ–∏–º–∏—Ç: 250,000 —Ç–æ–∫–µ–Ω–æ–≤/–º–∏–Ω—É—Ç—É
- –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

#### C. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ë–î
- –ù—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `user`, `problem`, `is_correct`
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `difficulty_score`, `grade_level`

## üîß –ü–ª–∞–Ω –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–π—Ç–∏–Ω–≥—É/–ø—Ä–æ—Ñ–∏–ª—é

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å CORS**
2. **–î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
4. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select_related` –∏ `prefetch_related`
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ (–æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç)
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–µ–º

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Gemini API**
   - –î–æ–±–∞–≤–∏—Ç—å retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞—Ç—á–∏–Ω–≥ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

4. **Frontend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è JS/CSS
   - –°–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ (gzip)

## üìù –¢–µ–∫—É—â–∏–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### CORS
```python
# –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ settings.py
CORS_ALLOWED_ORIGINS = [...]
CORS_ALLOW_CREDENTIALS = True
```

### –°–µ—Å—Å–∏–∏
```python
SESSION_COOKIE_SECURE = False  # ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π
SESSION_COOKIE_SAMESITE = 'Lax'  # ‚ùå –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
SESSION_COOKIE_HTTPONLY = True
```

### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö
- PostgreSQL –∏–ª–∏ SQLite
- –ù–µ—Ç –≤–∏–¥–∏–º—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –≤–∞–∂–Ω—ã—Ö –ø–æ–ª—è—Ö
- –ù–µ—Ç connection pooling

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ arena views
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
4. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –£–ª—É—á—à–∏—Ç—å Gemini API –≤—ã–∑–æ–≤—ã
